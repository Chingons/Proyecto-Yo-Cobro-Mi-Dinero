{% extends "home.html"%}
{% block content %}

<div id="htmlrecibo">
    <div id="contenido-recibo">

        <input type="text" placeholder="Click aquí para mostrar sus clientes">
        <ul id="impresion-clientes-recibo">
        </ul>

        <table id="tabla-impresion-recibo">
            <tr>
                <th>ID</th>
                <th>FECHA</th>
                <th>MONTO ORIGINAL</th>
                <th>MONTO ACTUAL</th>
                <th>SELECCIONAR</th>
            </tr>
        </table>
    </div>
</div>


<script>
    var prueba;
    function conexion_json(){
        fetch('static/recibo.json')
        .then(devolucion => devolucion.json())
        .then(datos=> {
       var datos_json = datos
       var tamaño = Object.keys(datos_json).length;
        impresion(datos_json, tamaño);
    });

    }
    
     function impresion(vimprimir, tvariable){
        let ul_impresion = document.getElementById("impresion-clientes-recibo");
        
        for (let y=0; y<tvariable; y++){
            let li = document.createElement('li');
            let clickboton = document.createElement('button');
            clickboton.innerHTML = vimprimir[y]['nombre'] + " " + vimprimir[y]['telefono'] + " " 
            + vimprimir[y]['identificacion'] + " " + vimprimir[y]['direccion'];
            clickboton.addEventListener("click",function(){
                facturas(vimprimir[y]['facturas']);
            });
            li.appendChild(clickboton);
            ul_impresion.appendChild(li);
        }

     }

     function facturas(datos_facturas){
        let tabla_recibo = document.getElementById("tabla-impresion-recibo");
        let tamaño_tabla = tabla_recibo.rows.length;
        
        for (let o = tamaño_tabla -1; o>0; o--){
            tabla_recibo.deleteRow(o);}
        
        for (let p=0; p<datos_facturas.length; p++){
            let tr = document.createElement('tr');
            let td_id = document.createElement('td');
            let td_fecha = document.createElement('td');
            let td_monto_original = document.createElement('td');
            let td_monto_actual = document.createElement('td');
            let td_seleccionar = document.createElement('td');
            let boton_seleccionar = document.createElement("button");
            
            td_id.innerHTML = datos_facturas[p][0];
            td_fecha.innerHTML = datos_facturas[p][3];
            td_monto_original.innerHTML = datos_facturas[p][4];
            td_monto_actual.innerHTML = datos_facturas[p][5];
            boton_seleccionar.innerHTML = "SELECCIONAR";

            td_seleccionar.appendChild(boton_seleccionar);

            tr.appendChild(td_id);
            tr.appendChild(td_fecha);
            tr.appendChild(td_monto_original);
            tr.appendChild(td_monto_actual);
            tr.appendChild(td_seleccionar);

            tabla_recibo.appendChild(tr);} 
     }
     

     conexion_json();
</script>

{% endblock %}